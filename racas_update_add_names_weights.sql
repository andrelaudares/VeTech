-- =============================================================
-- UPDATE racas: adiciona colunas (nomes + pesos) e preenche dados
-- PostgreSQL 12+
-- =============================================================
BEGIN;

-- Adiciona colunas de nomes
ALTER TABLE public.racas ADD COLUMN IF NOT EXISTS nome_popular CITEXT;
ALTER TABLE public.racas ADD COLUMN IF NOT EXISTS nome_oficial CITEXT;

-- Adiciona colunas de peso
ALTER TABLE public.racas ADD COLUMN IF NOT EXISTS peso_min_kg NUMERIC(5,2);
ALTER TABLE public.racas ADD COLUMN IF NOT EXISTS peso_max_kg NUMERIC(5,2);
DO $$ BEGIN
  ALTER TABLE public.racas ADD COLUMN peso_medio_kg NUMERIC(5,2)
    GENERATED ALWAYS AS ((peso_min_kg + peso_max_kg)/2.0) STORED;
EXCEPTION WHEN duplicate_column THEN NULL; END $$;

-- Preenche nome_oficial a partir de nome (quando estiver nulo)
UPDATE public.racas SET nome_oficial = nome WHERE nome_oficial IS NULL;

-- Mapeia nomes populares em PT-BR
WITH map(en, pt) AS (
  VALUES
    ('German Shepherd Dog', 'Pastor Alemão'),
    ('Labrador Retriever', 'Labrador Retriever'),
    ('Golden Retriever', 'Golden Retriever'),
    ('Pug', 'Pug'),
    ('French Bulldog', 'Buldogue Francês'),
    ('Bulldog', 'Buldogue Inglês'),
    ('Rottweiler', 'Rottweiler'),
    ('Doberman Pinscher', 'Dobermann'),
    ('Chihuahua', 'Chihuahua'),
    ('Shih Tzu', 'Shih Tzu'),
    ('Yorkshire Terrier', 'Yorkshire Terrier'),
    ('Pomeranian', 'Spitz Alemão Anão (Pomerânia)'),
    ('Border Collie', 'Border Collie'),
    ('Australian Shepherd', 'Pastor Australiano'),
    ('Shetland Sheepdog', 'Pastor de Shetland'),
    ('Cocker Spaniel (English)', 'Cocker Spaniel Inglês'),
    ('American Cocker Spaniel', 'Cocker Spaniel Americano'),
    ('Cavalier King Charles Spaniel', 'Cavalier King Charles Spaniel'),
    ('Boston Terrier', 'Boston Terrier'),
    ('Maltese', 'Maltês'),
    ('Havanese', 'Havanês'),
    ('Bichon Frise', 'Bichon Frisé'),
    ('Shiba Inu', 'Shiba Inu'),
    ('Akita', 'Akita Inu'),
    ('American Akita', 'Akita Americano'),
    ('Cane Corso', 'Cane Corso'),
    ('Bernese Mountain Dog', 'Boiadeiro Bernês'),
    ('Great Dane', 'Dogue Alemão'),
    ('Newfoundland', 'Terra-Nova'),
    ('Saint Bernard', 'São Bernardo'),
    ('Samoyed', 'Samoieda'),
    ('Alaskan Malamute', 'Malamute do Alasca'),
    ('Staffordshire Bull Terrier', 'Staffordshire Bull Terrier'),
    ('Bull Terrier', 'Bull Terrier'),
    ('Miniature Bull Terrier', 'Bull Terrier Miniatura'),
    ('Bullmastiff', 'Bullmastiff'),
    ('Mastiff', 'Mastiff Inglês'),
    ('Neapolitan Mastiff', 'Mastim Napolitano'),
    ('Dogo Argentino', 'Dogo Argentino'),
    ('Dogo Canario (Presa Canario)', 'Presa Canário'),
    ('Dogue de Bordeaux', 'Dogue de Bordeaux'),
    ('Fila Brasileiro', 'Fila Brasileiro'),
    ('Rhodesian Ridgeback', 'Ridgeback Rodesiano'),
    ('Vizsla', 'Vizsla (Braco Húngaro)'),
    ('Weimaraner', 'Weimaraner'),
    ('German Shorthaired Pointer', 'Braco Alemão de Pelo Curto'),
    ('German Wirehaired Pointer', 'Braco Alemão de Pelo Duro'),
    ('English Pointer', 'Pointer Inglês'),
    ('Flat-Coated Retriever', 'Retriever de Pelo Liso'),
    ('Curly-Coated Retriever', 'Retriever de Pelo Encaracolado'),
    ('Portuguese Water Dog', 'Cão de Água Português'),
    ('Portuguese Podengo Pequeno', 'Podengo Português Pequeno'),
    ('Portuguese Sheepdog (Cão da Serra de Aires)', 'Cão da Serra de Aires'),
    ('Rafeiro do Alentejo', 'Rafeiro do Alentejo'),
    ('Estrela Mountain Dog (Cão da Serra da Estrela)', 'Cão da Serra da Estrela'),
    ('Perdigueiro Português (Portuguese Pointer)', 'Perdigueiro Português'),
    ('Podenco Canario', 'Podengo Canário'),
    ('Galgo Español', 'Galgo Espanhol'),
    ('Greyhound', 'Galgo Inglês'),
    ('Whippet', 'Whippet'),
    ('Borzoi', 'Borzoi (Galgo Russo)'),
    ('Saluki', 'Saluki'),
    ('Afghan Hound', 'Galgo Afegão'),
    ('Basenji', 'Basenji'),
    ('Belgian Malinois', 'Pastor Belga Malinois'),
    ('Belgian Tervuren', 'Pastor Belga Tervuren'),
    ('Belgian Sheepdog (Groenendael)', 'Pastor Belga Groenendael'),
    ('Belgian Laekenois', 'Pastor Belga Laekenois'),
    ('Bouvier des Flandres', 'Bouvier de Flandres'),
    ('Old English Sheepdog', 'Old English Sheepdog'),
    ('Dutch Shepherd', 'Pastor Holandês'),
    ('Canaan Dog', 'Cão de Canaã'),
    ('Irish Wolfhound', 'Lobero Irlandês'),
    ('Leonberger', 'Leonberger'),
    ('Tibetan Mastiff', 'Mastim Tibetano'),
    ('Caucasian Shepherd Dog', 'Pastor Caucasiano'),
    ('Central Asian Shepherd Dog', 'Pastor da Ásia Central'),
    ('Hovawart', 'Hovawart'),
    ('Norwegian Elkhound (Grey)', 'Elkhound Norueguês Cinza'),
    ('Keeshond', 'Keeshond'),
    ('Kangal Shepherd Dog', 'Cão Kangal'),
    ('Anatolian Shepherd Dog', 'Cão de Pastor da Anatólia')
)
UPDATE public.racas r
SET nome_popular = m.pt
FROM map m
WHERE (r.nome ILIKE m.en OR r.nome_oficial ILIKE m.en)
  AND (r.nome_popular IS NULL OR r.nome_popular = r.nome);

-- Defaults
UPDATE public.racas SET nome_popular = COALESCE(nome_popular, nome);
UPDATE public.racas SET nome_oficial = COALESCE(nome_oficial, nome);

-- Upsert de faixas de peso saudável (adulto)
WITH v(nome, min_kg, max_kg) AS (
  VALUES
    ('Labrador Retriever', 25.00, 36.00),
    ('Golden Retriever', 25.00, 34.00),
    ('German Shepherd Dog', 22.00, 40.00),
    ('Pug', 6.00, 8.00),
    ('Bulldog', 18.00, 25.00),
    ('French Bulldog', 8.00, 14.00),
    ('Beagle', 9.00, 13.00),
    ('Dachshund', 7.00, 15.00),
    ('Rottweiler', 35.00, 60.00),
    ('Doberman Pinscher', 30.00, 45.00),
    ('Boxer', 25.00, 34.00),
    ('Siberian Husky', 16.00, 27.00),
    ('Great Dane', 45.00, 82.00),
    ('Chihuahua', 1.50, 3.00),
    ('Shih Tzu', 4.00, 7.50),
    ('Yorkshire Terrier', 2.00, 3.20),
    ('Pomeranian', 1.40, 3.20),
    ('Border Collie', 12.00, 20.00),
    ('Australian Shepherd', 16.00, 32.00),
    ('Shetland Sheepdog', 6.00, 12.00),
    ('Cocker Spaniel (English)', 12.00, 16.00),
    ('American Cocker Spaniel', 9.00, 13.00),
    ('Cavalier King Charles Spaniel', 5.40, 8.20),
    ('Boston Terrier', 6.80, 11.40),
    ('Maltese', 1.80, 3.60),
    ('Havanese', 4.50, 7.30),
    ('Bichon Frise', 5.00, 8.00),
    ('Shiba Inu', 7.00, 12.00),
    ('Akita', 32.00, 59.00),
    ('American Akita', 36.00, 66.00),
    ('Cane Corso', 40.00, 50.00),
    ('Great Pyrenees', 36.00, 54.00),
    ('Bernese Mountain Dog', 36.00, 50.00),
    ('Newfoundland', 45.00, 70.00),
    ('Saint Bernard', 54.00, 82.00),
    ('Samoyed', 16.00, 30.00),
    ('Alaskan Malamute', 34.00, 43.00),
    ('American Staffordshire Terrier', 18.00, 32.00),
    ('Staffordshire Bull Terrier', 11.00, 17.00),
    ('Bull Terrier', 22.00, 38.00),
    ('Miniature Bull Terrier', 9.00, 16.00),
    ('Bullmastiff', 45.00, 59.00),
    ('Mastiff', 68.00, 100.00),
    ('Neapolitan Mastiff', 50.00, 70.00),
    ('Dogo Argentino', 35.00, 45.00),
    ('Dogo Canario (Presa Canario)', 38.00, 59.00),
    ('Dogue de Bordeaux', 45.00, 65.00),
    ('Fila Brasileiro', 40.00, 73.00),
    ('Rhodesian Ridgeback', 29.00, 41.00),
    ('Vizsla', 20.00, 30.00),
    ('Weimaraner', 25.00, 40.00),
    ('German Shorthaired Pointer', 20.00, 32.00),
    ('German Wirehaired Pointer', 25.00, 34.00),
    ('English Pointer', 20.00, 34.00),
    ('Flat-Coated Retriever', 25.00, 36.00),
    ('Curly-Coated Retriever', 25.00, 41.00),
    ('Portuguese Water Dog', 16.00, 25.00),
    ('Portuguese Podengo Pequeno', 4.00, 6.00),
    ('Portuguese Sheepdog (Cão da Serra de Aires)', 12.00, 18.00),
    ('Rafeiro do Alentejo', 35.00, 60.00),
    ('Estrela Mountain Dog (Cão da Serra da Estrela)', 30.00, 50.00),
    ('Perdigueiro Português (Portuguese Pointer)', 20.00, 27.00),
    ('Podenco Canario', 18.00, 25.00),
    ('Galgo Español', 20.00, 30.00),
    ('Greyhound', 27.00, 40.00),
    ('Whippet', 9.00, 14.00),
    ('Borzoi', 25.00, 47.00),
    ('Saluki', 16.00, 30.00),
    ('Afghan Hound', 22.00, 34.00),
    ('Basenji', 9.00, 11.00),
    ('Bearded Collie', 18.00, 27.00),
    ('Belgian Malinois', 20.00, 30.00),
    ('Belgian Tervuren', 20.00, 30.00),
    ('Belgian Sheepdog (Groenendael)', 20.00, 30.00),
    ('Belgian Laekenois', 20.00, 30.00),
    ('Briard', 25.00, 40.00),
    ('Bouvier des Flandres', 35.00, 45.00),
    ('Rough Collie', 20.00, 34.00),
    ('Border Terrier', 5.00, 7.00),
    ('Cairn Terrier', 6.00, 8.00),
    ('West Highland White Terrier', 6.00, 9.00),
    ('Scottish Terrier', 8.00, 10.00),
    ('Jack Russell Terrier', 6.00, 8.00),
    ('Parson Russell Terrier', 6.00, 8.00),
    ('Fox Terrier (Smooth)', 7.00, 9.00),
    ('Wire Fox Terrier', 7.00, 9.00),
    ('Airedale Terrier', 18.00, 29.00),
    ('Irish Terrier', 11.00, 13.00),
    ('Kerry Blue Terrier', 15.00, 18.00),
    ('Soft Coated Wheaten Terrier', 14.00, 18.00),
    ('Pekingese', 3.00, 6.00),
    ('Lhasa Apso', 5.00, 8.00),
    ('Tibetan Terrier', 8.00, 14.00),
    ('Chow Chow', 20.00, 32.00),
    ('Chinese Shar-Pei', 18.00, 29.00),
    ('Shikoku', 16.00, 25.00),
    ('Hokkaido', 20.00, 30.00),
    ('Kishu Ken', 14.00, 27.00),
    ('Japanese Spitz', 7.00, 11.00),
    ('Japanese Chin', 1.80, 4.00),
    ('Japanese Akitainu', 23.00, 32.00),
    ('Tosa', 40.00, 60.00),
    ('Greater Swiss Mountain Dog', 48.00, 64.00),
    ('Entlebucher Mountain Dog', 20.00, 30.00),
    ('Appenzeller Sennenhund', 22.00, 32.00),
    ('Italian Greyhound', 3.00, 7.00),
    ('Papillon', 3.00, 5.00),
    ('Pharaoh Hound', 18.00, 27.00),
    ('Ibizan Hound', 20.00, 30.00),
    ('Sloughi', 18.00, 27.00),
    ('Azawakh', 14.00, 25.00),
    ('Dalmatian', 20.00, 32.00),
    ('English Setter', 25.00, 30.00),
    ('Gordon Setter', 25.00, 36.00),
    ('Irish Setter', 25.00, 34.00),
    ('English Springer Spaniel', 18.00, 25.00),
    ('Welsh Springer Spaniel', 16.00, 25.00),
    ('Brittany', 13.00, 18.00),
    ('Clumber Spaniel', 25.00, 34.00),
    ('Field Spaniel', 16.00, 23.00),
    ('Boykin Spaniel', 11.00, 18.00),
    ('Nova Scotia Duck Tolling Retriever', 17.00, 23.00),
    ('Chesapeake Bay Retriever', 25.00, 36.00),
    ('Wirehaired Pointing Griffon', 20.00, 32.00),
    ('Small Munsterlander', 16.00, 26.00),
    ('Large Munsterlander', 25.00, 32.00),
    ('German Longhaired Pointer', 25.00, 34.00),
    ('Keeshond', 16.00, 20.00),
    ('Old English Sheepdog', 27.00, 45.00),
    ('Dutch Shepherd', 20.00, 30.00),
    ('Canaan Dog', 16.00, 25.00),
    ('Puli', 9.00, 16.00),
    ('Pumi', 8.00, 15.00),
    ('Mudi', 8.00, 13.00),
    ('Irish Wolfhound', 48.00, 82.00),
    ('Deerhound (Scottish Deerhound)', 34.00, 50.00),
    ('Leonberger', 41.00, 75.00),
    ('Komondor', 40.00, 60.00),
    ('Kuvasz', 35.00, 50.00),
    ('Anatolian Shepherd Dog', 41.00, 64.00),
    ('Kangal Shepherd Dog', 45.00, 65.00),
    ('Tibetan Mastiff', 34.00, 68.00),
    ('Caucasian Shepherd Dog', 45.00, 90.00),
    ('Central Asian Shepherd Dog', 40.00, 65.00),
    ('Romanian Carpathian Shepherd Dog', 32.00, 45.00),
    ('Romanian Mioritic Shepherd Dog', 45.00, 65.00),
    ('Tornjak', 28.00, 45.00),
    ('Šarplaninac (Sarplaninac)', 35.00, 45.00),
    ('Hovawart', 25.00, 40.00),
    ('Greenland Dog', 30.00, 35.00),
    ('Norwegian Elkhound (Grey)', 20.00, 27.00),
    ('Black Norwegian Elkhound', 18.00, 25.00),
    ('Swedish Elkhound (Jämthund)', 25.00, 35.00),
    ('Norwegian Buhund', 12.00, 18.00),
    ('Finnish Lapphund', 15.00, 24.00),
    ('Finnish Spitz', 10.00, 15.00),
    ('Swedish Vallhund', 9.00, 16.00),
    ('Icelandic Sheepdog', 9.00, 14.00)
)
UPDATE public.racas r
SET peso_min_kg = v.min_kg,
    peso_max_kg = v.max_kg
FROM v
WHERE r.nome ILIKE v.nome OR r.nome_oficial ILIKE v.nome OR r.nome_popular ILIKE v.nome;

COMMIT;
